{% extends 'base.html' %}
{% block title %}Hist√≥rico de Transa√ß√µes ¬∑ Tucupi Labs{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto animate-fade-in">
  <!-- Header -->
  <div class="mb-8 animate-slide-down">
    <h1 class="text-4xl font-display font-bold text-gradient mb-2">Hist√≥rico de Transa√ß√µes</h1>
    <p class="text-gray-400">Acompanhe todas as suas compras e vendas de cr√©ditos</p>
  </div>
  
  <!-- Estat√≠sticas -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="glass rounded-xl p-6 border border-white/10 hover-glow animate-slide-up" style="animation-delay: 0.1s;">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-400 mb-1">Total de Compras</h3>
          <p class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-blue-500 bg-clip-text text-transparent">{{ total_purchases }}</p>
        </div>
      </div>
    </div>
    
    <div class="glass rounded-xl p-6 border border-white/10 hover-glow animate-slide-up" style="animation-delay: 0.2s;">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-tucupi-green-500 to-tucupi-accent rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-tucupi-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-400 mb-1">Total de Vendas</h3>
          <p class="text-3xl font-bold text-gradient">{{ total_sales }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Transa√ß√µes -->
  {% if transactions %}
    <div class="space-y-4">
      {% for txn in transactions %}
        <div class="glass rounded-xl p-6 border border-white/10 hover-glow animate-slide-up">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <!-- Cabe√ßalho -->
              <div class="flex flex-wrap items-center gap-3 mb-4">
                <span class="text-sm font-mono text-gray-400">#{{ txn.id }}</span>
                
                {% if txn.buyer == user %}
                  <span class="px-3 py-1.5 bg-blue-500/20 border border-blue-500/30 text-blue-400 text-xs font-bold rounded-full">
                    üì• COMPRA
                  </span>
                {% else %}
                  <span class="px-3 py-1.5 bg-tucupi-green-500/20 border border-tucupi-green-500/30 text-tucupi-green-400 text-xs font-bold rounded-full">
                    üì§ VENDA
                  </span>
                {% endif %}
                
                {% if txn.status == 'COMPLETED' %}
                  <span class="px-3 py-1.5 bg-tucupi-green-500/20 border border-tucupi-green-500/30 text-tucupi-green-400 text-xs font-bold rounded-full">
                    ‚úì Conclu√≠da
                  </span>
                {% elif txn.status == 'PENDING' %}
                  <span class="px-3 py-1.5 bg-yellow-500/20 border border-yellow-500/30 text-yellow-400 text-xs font-bold rounded-full">
                    ‚è≥ Pendente
                  </span>
                {% else %}
                  <span class="px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-xs font-bold rounded-full">
                    ‚úó Cancelada
                  </span>
                {% endif %}
              </div>

              <!-- Detalhes -->
              <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm">
                <div>
                  <span class="text-gray-500 text-xs uppercase tracking-wider">Cr√©dito</span>
                  <a href="{% url 'credit_detail' txn.credit.id %}" 
                     class="block font-semibold text-tucupi-green-400 hover:text-tucupi-accent transition mt-1">
                    #{{ txn.credit.id }} - {{ txn.credit.origin }}
                  </a>
                </div>
                
                <div>
                  <span class="text-gray-500 text-xs uppercase tracking-wider">
                    {% if txn.buyer == user %}Vendedor{% else %}Comprador{% endif %}
                  </span>
                  <p class="font-semibold text-white mt-1">
                    {% if txn.buyer == user %}
                      {{ txn.seller.username }}
                    {% else %}
                      {{ txn.buyer.username }}
                    {% endif %}
                  </p>
                </div>
                
                <div>
                  <span class="text-gray-500 text-xs uppercase tracking-wider">Quantidade</span>
                  <p class="font-bold text-white mt-1">{{ txn.amount }} <span class="text-gray-400 text-xs">tCO‚ÇÇe</span></p>
                </div>
                
                <div>
                  <span class="text-gray-500 text-xs uppercase tracking-wider">Valor Total</span>
                  <p class="font-bold text-2xl text-gradient mt-1">R$ {{ txn.total_price|floatformat:2 }}</p>
                </div>
              </div>

              <!-- Timestamp -->
              <div class="mt-4 pt-4 border-t border-white/10">
                <div class="flex items-center gap-2 text-xs text-gray-500">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  {{ txn.timestamp|date:"d/m/Y H:i" }}
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-20 glass rounded-2xl border border-white/10 animate-scale-in">
      <div class="text-6xl mb-4">üìä</div>
      <p class="text-gray-400 text-lg mb-6">Voc√™ ainda n√£o tem transa√ß√µes</p>
      <a href="{% url 'credits_marketplace' %}" class="inline-block px-8 py-4 bg-gradient-to-r from-tucupi-green-500 to-tucupi-accent text-tucupi-black font-bold rounded-lg hover-glow transition-all hover:scale-105">
        <span class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          Ir para o Marketplace
        </span>
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
